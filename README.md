# roxytest

Inline tests with roxygen and testthat.

See demo package using this at [roxytest-demo](https://github.com/mikldk/roxytest-demo).

## Usage

### `testthat` roclet

Add the following lines to your package's `DESCRIPTION` file:
```
Imports:
  roxygen2, 
  testthat
Depends:
  R (>= 2.10),
  roxytest
Roxygen: list(roclets = c("namespace", "rd", "roxytest::testthat_roclet"))
```
(Or make appropriate changes to obtain similar results.) The reason that `roxytest` is in `Depends` rather than in `Imports` is to attach the package immediately.

Then run the following:
```r
roxygen2::roxygenise()
```

### Other roclets

Besides the `testthat_roclet`, there is also a `param_roclet` (see below).
This can be included by adding it to `Roxygen` in the  `DESCRIPTION` file just like 
`roxytest::testthat_roclet` was added above.
 
## Example

### `testthat` roclet

For example, if the file `R/functions.R` contains this code (from [roxytest-demo](https://github.com/mikldk/roxytest-demo)):

```r
#' A function to do x
#' 
#' @param x A number
#' 
#' @tests 
#' expect_equal(foo(2), sqrt(2))
#' expect_error(foo("a string"))
#' 
#' @return something
foo <- function(x) {
  return(sqrt(x))
}

#' A function to do y
#' 
#' @param x Character vector
#' @param y Character vector
#' 
#' @tests 
#' expect_equal(bar("A", "B"), paste("A", "B", sep = "/"))
#' 
#' @export
bar <- function(x, y) {
  paste0(x, "/", y)
}
```

Then `roxygen2::roxygenise()` will generated (with the `testthat_roclet` roclet) 
the file `tests/testthat/test-roxytest-functions.R` with this content:

```r
# Generated by roxytest: Do not edit by hand!

context("File R/functions.R")

test_that("Function foo()", {
  expect_equal(foo(2), sqrt(2))
  expect_error(foo("a string"))
})


test_that("Function bar()", {
  expect_equal(bar("A", "B"), paste("A", "B", sep = "/"))
})
```

### Other roclets


To demonstrate the `param_roclet` roclet assume that this block of documentation exists:

```r
#' Summing two numbers
#'
#' @param x A number
f <- function(x, y) {
  x + y
}
```

When the package is documented, the following output will be displayed:

```
Functions with @param inconsistency:
  * Function 'f' with title 'Summing two numbers' [in '/tmp/RtmpD1pt6C/file236720a7cef0']: 
    - Missing @param's: y
```

Similarly if there are too many documented arguments.


## Wish-list


* Rstudio: CTRL+SHIFT+D would run `roxygen2::roxygenise()` instead of `devtools::document(roclets=c('rd', 'collate', 'namespace'))`
    + Project options -> Build tools -> If all check marks are removed, nothing happens with CTRL+SHIFT+D. If instead `devtools::document()` would be ran it would work.
* `roxygen2` (see <https://github.com/r-lib/roxygen2/issues/891>): 
    + In `DESCRIPTION`, `Roxygen: list(roclets = c("namespace", "rd", "roxytest::testthat_roclet"))` must be added. It would be more consistent to omit `_roclet`.
    + Easier test; `roxygen2` uses `roxygen2::roc_proc_text`; it would be nice to be able to use multiple roclets

